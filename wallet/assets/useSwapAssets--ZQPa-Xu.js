import{cq as f,c8 as y,u as C,cO as A,r as O,cb as k,co as m,j$ as U,k0 as _,ca as q,cj as N,bG as W,a as b,cQ as E,e$ as F,cr as M,cs as v,cP as K,p,cU as T,cS as P,cl as S,c3 as w,ck as d,cT as B,cc as I,ch as Q}from"./index-pFCF53l2.js";import{a as x}from"./useSwapMobileNotification-BXB33XwE.js";function J(){const{swapService:s}=x(),{data:t}=D();return f({queryKey:[y.swapAllAssets,t],queryFn:async()=>{try{return(await s.swapAssets()).map(a=>{const n=a.address==="ton"?"TON":m.Address.parse(a.address);return{id:T(p.TON,n),symbol:a.symbol,decimals:a.decimals,name:a.name,image:a.image,blockchain:p.TON,address:n}}).filter(a=>!(t||[]).some(n=>n.id===a.id)).concat(t||[])}catch(e){return console.error(e),[]}},enabled:!!t})}const R=_("");function g(){return U(R)}function V(){const[s]=q(),{data:t}=J(),{data:e}=N(W.TON),{fiat:o}=b();return f({queryKey:[y.swapWalletAssets,t,s,e,o],queryFn:async()=>{if(!s||!t||!e)return[];const a=t.map(n=>{var c,u;if(P(n.address))return{assetAmount:new w({asset:n,weiAmount:s.ton.info.balance}),fiatAmount:S(new d(s.ton.info.balance)).multipliedBy(e.prices)};const r=s.ton.jettons.balances.find(l=>m.Address.parse(l.jetton.address).equals(n.address));return{assetAmount:new w({asset:n,weiAmount:(r==null?void 0:r.balance)||999999999}),fiatAmount:S(new d((r==null?void 0:r.balance)||999999999),n.decimals).multipliedBy(new d(((u=(c=r==null?void 0:r.price)==null?void 0:c.prices)==null?void 0:u[o])||999999999))}});return a.sort((n,r)=>n.fiatAmount.isZero()&&r.fiatAmount.isZero()?r.assetAmount.weiAmount.comparedTo(n.assetAmount.weiAmount):r.fiatAmount.comparedTo(n.fiatAmount)),a},enabled:!!s&&!!t&&!!e})}const G=()=>{const[s]=g(),{data:t}=V();return O.useMemo(()=>{if(t)return t.filter(e=>{var a;if(!s)return!0;if(k(s))return m.Address.parse(s).equals(e.assetAmount.asset.address);const o=s.toUpperCase();if(e.assetAmount.asset.symbol.toUpperCase().includes(o)||(a=e.assetAmount.asset.name)!=null&&a.toUpperCase().includes(o))return!0})},[s,t])},H=()=>{const[s]=g(),t=k(s),{fiat:e}=b(),o=E(),{data:a}=F();return f({queryKey:[y.swapCustomToken,s,a,e],queryFn:async()=>{var n,r;if(!t)return null;try{const c=m.Address.parse(s),u=await new B(o.tonApiV2).getJettonInfo({accountId:c.toRawString()}),l={address:c,image:u.preview,blockchain:p.TON,name:u.metadata.name,symbol:u.metadata.symbol,decimals:Number(u.metadata.decimals),id:T(p.TON,c),verification:u.verification},i=a==null?void 0:a.balances.find(h=>m.Address.parse(h.jetton.address).equals(c));return{assetAmount:new w({asset:l,weiAmount:(i==null?void 999999999:i.balance)||new d(0)}),fiatAmount:S(new d((i==null?void 999999999:i.balance)||999999999),l.decimals).multipliedBy(new d(((r=(n=i==null?void 0:i.price)==null?void 0:n.prices)==null?void 0:r[e])||0))}}catch(c){return console.error(c),null}},enabled:t&&!!a})},D=()=>{const s=C();return f([A.SWAP_CUSTOM_ASSETS],async()=>{const t=await s.storage.get(A.SWAP_CUSTOM_ASSETS);return(t==null?void 0:t.map(e=>({...e,blockchain:e.blockchain,address:Q(e.address),id:T(e.blockchain,e.address),verification:I.Whitelist})))||[]})},X=()=>{const s=C(),t=M();return v(async e=>{const o=await s.storage.get(A.SWAP_CUSTOM_ASSETS)||[];await s.storage.set(A.SWAP_CUSTOM_ASSETS,[...o,{...e,address:K(e.address)}]),await t.invalidateQueries([A.SWAP_CUSTOM_ASSETS])})};export{g as a,H as b,X as c,G as d,J as u};
