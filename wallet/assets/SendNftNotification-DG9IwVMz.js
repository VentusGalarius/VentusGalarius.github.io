import{j as e,ik as X,jc as Y,jp as Z,im as ee,b as R,u as _,k as se,cA as P,dg as F,cC as W,jq as L,H as D,m as H,l as b,dN as te,a as O,r as i,a$ as G,dl as ne,jr as re,c3 as ie,F as oe,js as ae,dm as ce,dn as de,jt as le,ju as ue,jv as fe,j8 as me,jw as he,iD as pe,fd as xe,cz as ge,i as Q,G as ye,d8 as $,dd as K,g9 as U,dc as Ae,ga as Te,gs as q,cq as je,c8 as we,d7 as Se,gb as Ce,d9 as Ne,cs as ke,q as z,i$ as M,ck as Ee,co as J,j0 as be,ez as ve,ec as Be,s as Me,iF as Re,N as _e,iG as Fe,p as V,iL as We,fM as Le,fN as De,iM as He,iN as I,iO as Ve,iP as Ie,iQ as Pe,iV as Oe,iW as Ge,fJ as Qe,iX as $e}from"./index-pFCF53l2.js";import{T as Ke}from"./TransitionGroup-Ba4hsFgp.js";const Ue=({onBack:r,onClose:s})=>e.jsxs(X,{children:[e.jsx(Y,{onClick:r,children:e.jsx(Z,{})}),e.jsx(ee,{handleClose:s})]}),qe=({nftItem:r})=>{const{t:s}=R(),t=_(),n=se();return e.jsxs(P,{fullWidth:!0,children:[r.collection&&e.jsx(F,{onClick:()=>t.copyToClipboard(b(r.collection.address,n,!0)),children:e.jsxs(W,{children:[e.jsx(L,{children:s("NFT_collection_id")}),e.jsx(D,{children:H(b(r.collection.address,n,!0))})]})}),e.jsx(F,{onClick:()=>t.copyToClipboard(b(r.address,n,!0)),children:e.jsxs(W,{children:[e.jsx(L,{children:s("NFT_item_id")}),e.jsx(D,{children:H(b(r.address,n,!0))})]})})]})},ze=new ie({asset:z,weiAmount:0}),Je=(r,s,t)=>{const n=Q(),u=ye(),d=$(),f=i.useMemo(()=>{if(t){if(n.type==="ton-multisig")return{type:"multisig",ttlSeconds:5*60};if(t==="external")return K;if(t==="battery")return U;throw new Error(`Unsupported sender type for nft transfer ${t}`)}},[t,n]),g=Ae(f),A=Te(g),T=q();return je([we.estimate,s==null?void 0:s.address,u,A],async()=>{try{if(n.type==="watch-only")throw new Error("account not controllable");const c=new M(n.activeTonWallet.rawAddress),o=await g(),l=c.encodeNftTransfer({nftAddress:r.address,recipientAddress:s.address.address,forwardPayload:s.comment?J.comment(s.comment):null,responseAddress:"excessAddress"in o&&o.excessAddress?o.excessAddress:void 0});return await T.estimate(o,l)}catch(c){throw await d(c),c}},{enabled:s!=null&&!!g&&f!==void 0})},Xe=(r,s,t,n)=>{const u=Q(),d=Se(),{mutateAsync:f}=Ce(),g=Ne(),A=q(),T=$();return ke(async()=>{var c;if(u.type==="watch-only")return console.error("Can't send a transfer using this account"),!1;if(!t)return!1;if(t.fee.type==="ton-asset"&&t.fee.extra.asset.id!==z.id)throw new Error(`Unexpected fee ${t.fee}`);try{let o;if(u.type==="ton-multisig"){if(n.multisigTTL===void 0)throw new Error("TTL must be specified for multisig sending");o={type:"multisig",ttlSeconds:60*Number(n.multisigTTL)}}else if(n.selectedSenderType==="external")o=K;else if(n.selectedSenderType==="battery")o=U;else throw new Error(`Unsupported sender type for nft transfer ${n.selectedSenderType}`);const l=await g(o),j=new M(u.activeTonWallet.rawAddress),m=new Ee(M.nftTransferBase.toString()).plus(Math.abs(((c=t.event)==null?void 0:c.extra)??0)),h=j.encodeNftTransfer({nftAddress:s.address,recipientAddress:r.address.address,forwardPayload:r.comment?J.comment(r.comment):null,nftTransferAmountWei:m,responseAddress:"excessAddress"in l&&l.excessAddress?l.excessAddress:void 0});await A.send(l,be,h),d("send-nft")}catch(o){await T(o)}return await f(),!0})},Ye={type:"nfr_transfer"},Ze=({recipient:r,onClose:s,nftItem:t,headerBlock:n,mainButton:u,multisigTTL:d,isAnimationProcess:f})=>{var E;const A=te()&&f,{standalone:T}=O(),[c,o]=i.useState(!1),{t:l}=R(),j=G(),{data:m}=ne(Ye),[h,w]=i.useState(),N=Je(t,r,h),{mutateAsync:v,isLoading:y,error:S,reset:B,isIdle:k}=Xe(r,t,N.data,{multisigTTL:d,selectedSenderType:h});i.useEffect(()=>{k&&m&&w(m[0].type)},[JSON.stringify(m),k]);const C=(E=t.previews)==null?void 0:E.find(x=>x.resolution==="100x100"),a=async()=>{if(y)return!1;try{B();const x=await v();return x&&(o(!0),setTimeout(s,2e3)),x}catch(x){return console.error(x),!1}},p=async x=>{x.stopPropagation(),x.preventDefault()};return e.jsx(re.Provider,{value:{recipient:r,assetAmount:ze,estimation:N,formState:{done:c,isLoading:y,error:S},onClose:()=>s(),onBack:()=>{},handleSubmit:a},children:e.jsxs(oe,{onSubmit:p,standalone:T,children:[n,e.jsxs(ae,{children:[C?e.jsx(ce,{src:C.url}):e.jsx(de,{}),e.jsx(le,{children:t.dns??t.metadata.name}),e.jsx(ue,{children:l("txActions_signRaw_types_nftItemTransfer")})]}),e.jsxs(P,{margin:!1,fullWidth:!0,children:[e.jsx(fe,{}),e.jsx(me,{availableSendersChoices:m,selectedSenderType:h,onSenderTypeChange:w}),e.jsx(he,{})]}),e.jsx(qe,{nftItem:t}),e.jsx(pe,{}),j&&d?e.jsx(ss,{ttl:d}):null,!A&&e.jsx(xe,{children:e.jsx(ge,{children:u})})]})})},es=Me(Re)`
    margin-bottom: 1rem;
`,ss=({ttl:r})=>{const{data:s}=ve(),{signerWallet:t}=Be();return s?e.jsx(es,{status:"progress",signedWallets:[],threshold:s.threshold,pendingWallets:s.signers,hostAddress:t.rawAddress,secondsLeft:Number(r)*60}):null},ts=({nftItem:r,onClose:s})=>{const t=_(),{t:n}=R(),{standalone:u,extension:d}=O(),f=i.useRef(null),g=i.useRef(null),A=i.useRef(null),[T,c]=i.useState(!0),[o,l]=i.useState(),j=G(),{mutateAsync:m}=Fe(),h=async a=>{c(!0),l(a),S("confirm")},w=i.useCallback(()=>{c(!1),l(a=>a?{...a,done:!1}:void 0),S("recipient")},[l]),[N,v]=i.useState(),[y,S]=i.useState(j?"multisig-settings":"recipient"),B=i.useCallback(async({address:a})=>{const p={address:a},E=await m(p);h({address:{...p,blockchain:V.TON},toAccount:E,comment:"",done:!0})},[h,m]),k=async a=>{const p=$e({url:a});if(p===null)return t.uiEvents.emit("copy",{method:"copy",params:n("Unexpected_QR_Code")});await B(p)},C={"multisig-settings":f,recipient:g,confirm:A}[y];return e.jsx(We,{standalone:u,extension:d,children:e.jsx(Ke,{childFactory:Le(T),children:e.jsx(De,{nodeRef:C,classNames:"right-to-left",addEndListener:a=>{setTimeout(a,Qe)},children:a=>e.jsxs("div",{ref:C,children:[y==="multisig-settings"&&e.jsx(He,{onSubmit:p=>{c(!0),v(p.lifetime),S("recipient")},isAnimationProcess:a==="exiting",header:e.jsx(Ve,{title:n("multisig_create_order_title"),onClose:s}),MainButton:I}),y==="recipient"&&e.jsx(Ie,{data:o,setRecipient:h,onScan:k,acceptBlockchains:[V.TON],MainButton:I,HeaderBlock:()=>e.jsx(Pe,{title:n("nft_transfer_title"),onClose:s,onBack:j?w:void 0}),isAnimationProcess:a==="exiting"}),y==="confirm"&&e.jsx(Ze,{onClose:s,recipient:o,nftItem:r,mainButton:e.jsx(Oe,{MainButton:Ge}),headerBlock:e.jsx(Ue,{onBack:w,onClose:s}),multisigTTL:N,isAnimationProcess:a==="exiting"})]})},y)})})},is=()=>{const r=_(),[s,t]=i.useState(),n=i.useCallback(()=>{t(void 0)},[t]);i.useEffect(()=>{const d=f=>{t(f.params)};return r.uiEvents.on("transferNft",d),()=>{r.uiEvents.off("transferNft",d)}},[]);const u=i.useCallback(()=>{if(s)return e.jsx(ts,{onClose:n,nftItem:s})},[s,n]);return e.jsx(_e,{isOpen:!!s,handleClose:n,hideButton:!0,backShadow:!0,mobileFullScreen:!0,children:u})};export{is as default};
