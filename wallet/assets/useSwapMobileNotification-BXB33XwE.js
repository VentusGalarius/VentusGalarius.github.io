var X=Object.defineProperty;var x=t=>{throw TypeError(t)};var ee=(t,e,r)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var g=(t,e,r)=>ee(t,typeof e!="symbol"?e+"":e,r),B=(t,e,r)=>e.has(t)||x("Cannot "+r);var c=(t,e,r)=>(B(t,e,"read from private field"),r?r.call(t):e.get(t)),y=(t,e,r)=>e.has(t)?x("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),d=(t,e,r,n)=>(B(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);import{co as G,d as te,aq as se,k0 as C,ic as re,q as U,j$ as b,r as F,ck as w,dK as ne,cq as J,c8 as W,cj as k,cP as I,cS as ae,a as v,u as oe}from"./index-pFCF53l2.js";function K(t,e){if(t&&t===e)return!0;try{return e?(typeof t=="string"&&(t=G.Address.parse(t)),typeof e=="string"&&(e=G.Address.parse(e)),t.equals(e)):!1}catch{return!1}}class H extends Error{constructor(r,n,s){super(s);g(this,"url");g(this,"status");g(this,"statusText");g(this,"body");g(this,"request");this.name="ApiError",this.url=n.url,this.status=n.status,this.statusText=n.statusText,this.body=n.body,this.request=r}}class ie extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}}var p,h,f,m,A,T,S;class ce{constructor(e){y(this,p);y(this,h);y(this,f);y(this,m);y(this,A);y(this,T);y(this,S);d(this,p,!1),d(this,h,!1),d(this,f,!1),d(this,m,[]),d(this,A,new Promise((r,n)=>{d(this,T,r),d(this,S,n);const s=i=>{c(this,p)||c(this,h)||c(this,f)||(d(this,p,!0),c(this,T)&&c(this,T).call(this,i))},a=i=>{c(this,p)||c(this,h)||c(this,f)||(d(this,h,!0),c(this,S)&&c(this,S).call(this,i))},o=i=>{c(this,p)||c(this,h)||c(this,f)||c(this,m).push(i)};return Object.defineProperty(o,"isResolved",{get:()=>c(this,p)}),Object.defineProperty(o,"isRejected",{get:()=>c(this,h)}),Object.defineProperty(o,"isCancelled",{get:()=>c(this,f)}),e(s,a,o)}))}get[Symbol.toStringTag](){return"Cancellable Promise"}then(e,r){return c(this,A).then(e,r)}catch(e){return c(this,A).catch(e)}finally(e){return c(this,A).finally(e)}cancel(){if(!(c(this,p)||c(this,h)||c(this,f))){if(d(this,f,!0),c(this,m).length)try{for(const e of c(this,m))e()}catch(e){console.warn("Cancellation threw an error",e);return}c(this,m).length=0,c(this,S)&&c(this,S).call(this,new ie("Request aborted"))}}get isCancelled(){return c(this,f)}}p=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,A=new WeakMap,T=new WeakMap,S=new WeakMap;const E={BASE:"",VERSION:"1.0.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},P=t=>t!=null,R=t=>typeof t=="string",$=t=>R(t)&&t!=="",q=t=>typeof t=="object"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.arrayBuffer=="function"&&typeof t.constructor=="function"&&typeof t.constructor.name=="string"&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),M=t=>t instanceof FormData,ue=t=>{try{return btoa(t)}catch{return te.Buffer.from(t).toString("base64")}},de=t=>{const e=[],r=(s,a)=>{e.push(`${encodeURIComponent(s)}=${encodeURIComponent(String(a))}`)},n=(s,a)=>{P(a)&&(Array.isArray(a)?a.forEach(o=>{n(s,o)}):typeof a=="object"?Object.entries(a).forEach(([o,i])=>{n(`${s}[${o}]`,i)}):r(s,a))};return Object.entries(t).forEach(([s,a])=>{n(s,a)}),e.length>0?`?${e.join("&")}`:""},fe=(t,e)=>{const r=encodeURI,n=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,(a,o)=>{var i;return(i=e.path)!=null&&i.hasOwnProperty(o)?r(String(e.path[o])):a}),s=`${t.BASE}${n}`;return e.query?`${s}${de(e.query)}`:s},le=t=>{if(t.formData){const e=new FormData,r=(n,s)=>{R(s)||q(s)?e.append(n,s):e.append(n,JSON.stringify(s))};return Object.entries(t.formData).filter(([n,s])=>P(s)).forEach(([n,s])=>{Array.isArray(s)?s.forEach(a=>r(n,a)):r(n,s)}),e}},N=async(t,e)=>e,pe=async(t,e)=>{const[r,n,s,a]=await Promise.all([N(e,t.TOKEN),N(e,t.USERNAME),N(e,t.PASSWORD),N(e,t.HEADERS)]),o=Object.entries({Accept:"application/json",...a,...e.headers}).filter(([i,u])=>P(u)).reduce((i,[u,l])=>({...i,[u]:String(l)}),{});if($(r)&&(o.Authorization=`Bearer ${r}`),$(n)&&$(s)){const i=ue(`${n}:${s}`);o.Authorization=`Basic ${i}`}return e.body!==void 0&&(e.mediaType?o["Content-Type"]=e.mediaType:q(e.body)?o["Content-Type"]=e.body.type||"application/octet-stream":R(e.body)?o["Content-Type"]="text/plain":M(e.body)||(o["Content-Type"]="application/json")),new Headers(o)},he=t=>{var e;if(t.body!==void 0)return(e=t.mediaType)!=null&&e.includes("/json")?JSON.stringify(t.body):R(t.body)||q(t.body)||M(t.body)?t.body:JSON.stringify(t.body)},ye=async(t,e,r,n,s,a,o)=>{const i=new AbortController,u={headers:a,body:n??s,method:e.method,signal:i.signal};return o(()=>i.abort()),await fetch(r,u)},me=(t,e)=>{if(e){const r=t.headers.get(e);if(R(r))return r}},Se=async t=>{if(t.status!==204)try{const e=t.headers.get("Content-Type");if(e)return["application/json","application/problem+json"].some(s=>e.toLowerCase().startsWith(s))?await t.json():await t.text()}catch(e){console.error(e)}},we=(t,e)=>{const n={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(n)throw new H(t,e,n);if(!e.ok){const s=e.status??"unknown",a=e.statusText??"unknown",o=(()=>{try{return JSON.stringify(e.body,null,2)}catch{return}})();throw new H(t,e,`Generic Error: status: ${s}; status text: ${a}; body: ${o}`)}},j=(t,e)=>new ce(async(r,n,s)=>{try{const a=fe(t,e),o=le(e),i=he(e),u=await pe(t,e);if(!s.isCancelled){const l=await ye(t,e,a,i,o,u,s),Y=await Se(l),Z=me(l,e.responseHeader),D={url:a,ok:l.ok,status:l.status,statusText:l.statusText,body:Z??Y};we(e,D),r(D.body)}}catch(a){n(a)}});class Ae{static calculateSwap(e,r,n,s){return j(E,{method:"GET",url:"/v2/swap/calculate",query:{fromAsset:e,toAsset:r,fromAmount:n,provider:s},errors:{500:"Default Response"}})}static encodeSwap(e){return j(E,{method:"POST",url:"/v2/swap/encode",body:e,mediaType:"application/json",errors:{500:"Default Response"}})}static swapGas(){return j(E,{method:"GET",url:"/v2/swap/gas",errors:{500:"Default Response"}})}static swapAssets(){return j(E,{method:"GET",url:"/v2/swap/assets",errors:{500:"Default Response"}})}}const V=()=>{const t=se();return E.BASE=t.web_swaps_url,{swapService:Ae,referralAddress:t.web_swaps_referral_address,isSwapsEnabled:!!t.web_swaps_url}},O=C(U),_=C(re),be=C(new w(1)),z=()=>{const[t,e]=b(O),[r,n]=b(_),s=F.useCallback(a=>{K(a.address,_.value.address)&&n(O.value),e(a)},[e,n]);return[t,s]},ge=()=>{const[t,e]=b(_),[r,n]=b(O),s=F.useCallback(a=>{K(a.address,O.value.address)&&n(_.value),e(a)},[e,n]);return[t,s]},Te=()=>b(be),je=()=>{const{data:e,isError:r}=Ee(),[n]=z(),s=ne(n);return J({queryKey:[W.swapMaxValue,e,n.id,s==null?void 0:s.toFixed(0)],queryFn:async()=>{if(r)return s;if(!(!s||!e))if(n.id===U.id){const a=new w(e.dedust.tonToJetton),o=new w(e.stonfi.tonToJetton),i=s.minus(w.max(a,o)).minus(1e6);return i.lt(0)?new w(0):i}else return s},enabled:(!!e||r)&&s!==void 0})},Ee=()=>{const{swapService:t}=V();return J({queryKey:[W.swapGasConfig],queryFn:async()=>t.swapGas()})},Oe=C(void 0),_e=()=>b(Oe),$e=()=>{const[t]=z(),[e]=ge(),[r]=_e(),{data:n,isLoading:s}=k(I(t.address)),{data:a,isLoading:o}=k(I(e.address)),i=r==null?void 0:r.trade;if(!i||o||s)return;if(!(n!=null&&n.prices)||!(a!=null&&a.prices))return null;const u=new w(i.from.relativeAmount).multipliedBy(n.prices),l=new w(i.to.relativeAmount).multipliedBy(a.prices);return u.isEqualTo(l)?new w(0):u.minus(l).dividedBy(u)},Fe=t=>t?t.isGreaterThan(.05)?"high":t.isGreaterThan(.01)?"medium":"low":"unknown",Pe=()=>{const[t]=Te();return!t||t.isZero()},qe=(t,e)=>{const{tonendpoint:r,env:n}=v();return Q(t,e,r.targetEnv,n==null?void 0:n.stonfiReferralAddress)},Q=(t,e,r,n)=>{const s=new URL("https://app.ston.fi/swap");return s.searchParams.append("ft",L(t)),s.searchParams.append("tt",L(e)),s.searchParams.append("referral_address",n||""),s.searchParams.append("utm_source",`tokeeper-${r}`),s.searchParams.append("utm_medium","organic"),s.searchParams.append("utm_campaign","swap_button"),s.searchParams.append("utm_content","TODO"),s.toString()},L=t=>ae(t)?"ton":t.toString({urlSafe:!0}),Ce=C(!1),De=()=>{const[t,e]=b(Ce),{isSwapsEnabled:r}=V(),n=oe(),{tonendpoint:s,env:a}=v(),o=F.useCallback(i=>{if(i&&!r){const u=Q(O.value.address,_.value.address,s.targetEnv,a==null?void 0:a.stonfiReferralAddress);n.openPage(u)}else e(i)},[e,r,n,s.targetEnv,a==null?void 0:a.stonfiReferralAddress]);return[t,o]};export{V as a,qe as b,O as c,De as d,K as e,ge as f,Te as g,_e as h,Pe as i,je as j,$e as k,Fe as p,_ as s,z as u};
