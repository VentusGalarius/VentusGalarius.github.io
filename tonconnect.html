<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Connect –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(46, 125, 209, 0.3);
        }

        .header h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #0088cc, #00aaff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #a0c8e0;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 35, 56, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(46, 125, 209, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .panel-title {
            font-size: 1.8rem;
            color: #00aaff;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title i {
            font-size: 1.5rem;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #80d0ff;
            font-size: 1.1rem;
        }

        .input-field {
            width: 100%;
            padding: 15px 20px;
            background: rgba(20, 25, 40, 0.8);
            border: 2px solid rgba(46, 125, 209, 0.4);
            border-radius: 12px;
            color: #ffffff;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #0088cc;
            box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.2);
        }

        .input-hint {
            margin-top: 8px;
            font-size: 0.9rem;
            color: #88aacc;
        }

        .button {
            display: inline-block;
            padding: 16px 32px;
            background: linear-gradient(90deg, #0066cc, #0088ff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
            margin-top: 10px;
        }

        .button:hover {
            background: linear-gradient(90deg, #0055aa, #0077dd);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 102, 204, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: linear-gradient(90deg, #444477, #666699);
        }

        .button-secondary:hover {
            background: linear-gradient(90deg, #333366, #555588);
        }

        .button-success {
            background: linear-gradient(90deg, #00aa44, #00cc66);
        }

        .button-success:hover {
            background: linear-gradient(90deg, #009933, #00bb55);
        }

        .button-danger {
            background: linear-gradient(90deg, #cc3300, #ff5500);
        }

        .button-danger:hover {
            background: linear-gradient(90deg, #bb2200, #ee4400);
        }

        .qr-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            min-height: 300px;
            background: rgba(10, 15, 30, 0.6);
            border-radius: 15px;
            padding: 20px;
        }

        #qrCode {
            width: 256px;
            height: 256px;
            border: 15px solid white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .result-container {
            background: rgba(20, 25, 40, 0.9);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border-left: 5px solid #0088cc;
            word-break: break-all;
        }

        .result-title {
            font-size: 1.2rem;
            color: #80d0ff;
            margin-bottom: 15px;
        }

        .result-content {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .status-connected {
            background: rgba(0, 200, 100, 0.2);
            color: #00ff88;
            border: 1px solid rgba(0, 200, 100, 0.5);
        }

        .status-disconnected {
            background: rgba(255, 80, 80, 0.2);
            color: #ff6666;
            border: 1px solid rgba(255, 80, 80, 0.5);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-connected .status-dot {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .status-disconnected .status-dot {
            background: #ff6666;
            box-shadow: 0 0 10px #ff6666;
        }

        .wallet-info {
            background: rgba(30, 40, 70, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .wallet-info.show {
            display: block;
        }

        .wallet-address {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #80d0ff;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .wallet-balance {
            font-size: 1.4rem;
            color: #00ffaa;
            font-weight: bold;
            margin: 10px 0;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .deep-link-container {
            margin-top: 20px;
        }

        .deep-link {
            display: block;
            padding: 15px;
            background: rgba(0, 40, 80, 0.6);
            border-radius: 10px;
            color: #80d0ff;
            text-decoration: none;
            word-break: break-all;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .deep-link:hover {
            background: rgba(0, 60, 120, 0.8);
        }

        .format-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .format-badge {
            padding: 6px 12px;
            background: rgba(70, 100, 150, 0.4);
            border-radius: 20px;
            font-size: 0.9rem;
            color: #a0c8ff;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(30, 40, 70, 0.95);
            border-radius: 10px;
            border-left: 5px solid #0088cc;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            max-width: 400px;
        }

        .notification.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid rgba(46, 125, 209, 0.2);
            color: #88aacc;
            font-size: 0.9rem;
        }

        .loader {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #0088cc;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(46, 125, 209, 0.3);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-title {
            font-size: 1.8rem;
            color: #00aaff;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
    </style>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/ton-core@0.58.2/dist/ton-core.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/lib/tonconnect.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TON Connect –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</h1>
            <p>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤–∞—à TON –∫–æ—à–µ–ª–µ–∫ —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –∏–ª–∏ deep link. –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ Tonkeeper.</p>
        </div>

        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –í–≤–æ–¥ –∞–¥—Ä–µ—Å–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è -->
            <div class="panel">
                <h2 class="panel-title">
                    <span>üîó</span> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
                </h2>
                
                <div class="status-indicator status-disconnected" id="statusIndicator">
                    <div class="status-dot"></div>
                    <span id="statusText">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                </div>

                <div class="input-group">
                    <label class="input-label" for="walletAddress">–ê–¥—Ä–µ—Å TON –∫–æ—à–µ–ª—å–∫–∞</label>
                    <input type="text" 
                           id="walletAddress" 
                           class="input-field" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: EQDrja... –∏–ª–∏ name.ton –∏–ª–∏ @username">
                    <div class="input-hint">
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .ton, hex, base64, user-friendly, *.t.me
                    </div>
                    <div class="format-examples">
                        <div class="format-badge">EQDrjaL... (hex)</div>
                        <div class="format-badge">name.ton</div>
                        <div class="format-badge">username.t.me</div>
                        <div class="format-badge">kQC9Kp... (base64)</div>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" for="websiteUrl">URL —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</label>
                    <input type="text" 
                           id="websiteUrl" 
                           class="input-field" 
                           value="https://tfragment.stel.com"
                           placeholder="https://fragment.com">
                </div>

                <button class="button" id="generateQrBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
                <button class="button button-secondary" id="validateAddressBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥—Ä–µ—Å</button>
                <button class="button button-success" id="connectTonkeeperBtn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ Tonkeeper</button>
                <button class="button button-danger hidden" id="disconnectBtn">–û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
                
                <div class="deep-link-container hidden" id="deepLinkContainer">
                    <div class="input-label">Deep Link –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
                    <a href="#" id="deepLink" class="deep-link" target="_blank">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</a>
                </div>

                <div class="wallet-info" id="walletInfo">
                    <div class="input-label">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ</div>
                    <div class="wallet-address" id="connectedAddress"></div>
                    <div class="wallet-balance" id="walletBalance">0 TON</div>
                    <div class="action-buttons">
                        <button class="button button-secondary" id="copyAddressBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
                        <button class="button" id="sendTransactionBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: QR-–∫–æ–¥ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="panel">
                <h2 class="panel-title">
                    <span>üì±</span> QR-–∫–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                </h2>
                
                <div class="qr-container">
                    <canvas id="qrCode"></canvas>
                </div>

                <div class="input-group">
                    <label class="input-label">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</label>
                    <div class="result-container">
                        <div class="result-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏</div>
                        <div class="result-content" id="connectionInfo">
                            –û–∂–∏–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞...
                        </div>
                    </div>
                </div>

                <button class="button button-secondary" id="downloadQrBtn">–°–∫–∞—á–∞—Ç—å QR-–∫–æ–¥</button>
                <button class="button" id="refreshQrBtn">–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>

                <div class="result-container hidden" id="rawRequestContainer">
                    <div class="result-title">Raw Request (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)</div>>
                    <div class="result-content" id="rawRequest"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>TON Connect | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ—à–µ–ª—å–∫–∏: Tonkeeper, OpenMask, MyTonWallet</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div class="modal-overlay" id="transactionModal">
        <div class="modal">
            <h2 class="modal-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</h2>
            <div class="input-group">
                <label class="input-label" for="txToAddress">–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                <input type="text" id="txToAddress" class="input-field" placeholder="EQDrja...">
            </div>
            <div class="input-group">
                <label class="input-label" for="txAmount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ TON</label>
                <input type="number" id="txAmount" class="input-field" placeholder="1.5" step="0.001" min="0">
            </div>
            <div class="input-group">
                <label class="input-label" for="txPayload">–°–æ–æ–±—â–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <textarea id="txPayload" class="input-field" rows="3" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="button button-success" id="txSubmitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button class="button button-secondary" id="txCancelBtn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <div id="notificationMessage"></div>
    </div>

    <script>
        // ============================================================================
        // –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º TON Connect
        // ============================================================================
        class TONConnectionManager {
            constructor() {
                this.connector = null;
                this.wallet = null;
                this.manifestUrl = 'https://tfragment.stel.com/tonconnect-manifest.json';
                this.init();
            }

            async init() {
                try {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect SDK
                    this.connector = new TonConnectSDK.TonConnect({
                        manifestUrl: this.manifestUrl
                    });

                    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–µ—Å—Å–∏–∏
                    await this.connector.restoreConnection();
                    this.wallet = this.connector.wallet;

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    if (this.wallet) {
                        this.updateUIForConnectedWallet();
                        this.showNotification('–ö–æ—à–µ–ª–µ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ —Å–µ—Å—Å–∏–∏', 'success');
                    }

                    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
                    this.connector.onStatusChange((wallet) => {
                        this.wallet = wallet;
                        if (wallet) {
                            this.updateUIForConnectedWallet();
                            this.showNotification('–ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                        } else {
                            this.updateUIForDisconnectedWallet();
                            this.showNotification('–ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω', 'warning');
                        }
                    });

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TON Connect:', error);
                    this.showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å TON Connect', 'error');
                }
            }

            async generateConnectionRequest(websiteUrl) {
                if (!this.connector) throw new Error('TON Connect –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

                try {
                    // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º tonProof
                    const request = await this.connector.connect({
                        tonProof: true
                    });

                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
                    const universalLink = this.connector.getUniversalLink(request);
                    // Deep-link –¥–ª—è Tonkeeper
                    const tonkeeperDeepLink = `tonkeeper://connect?url=${encodeURIComponent(universalLink)}`;

                    return { universalLink, tonkeeperDeepLink, request };
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error);
                    throw error;
                }
            }

            async getWalletInfo() {
                if (!this.wallet) return null;

                try {
                    // –ó–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ TON Center API
                    const balance = await this.fetchBalance(this.wallet.account.address);
                    return {
                        address: this.wallet.account.address,
                        publicKey: this.wallet.account.publicKey,
                        chain: this.wallet.account.chain,
                        balance: balance
                    };
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ:', error);
                    return null;
                }
            }

            async fetchBalance(address) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π endpoint TON Center API (—Ç—Ä–µ–±—É–µ—Ç—Å—è API-–∫–ª—é—á –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
                const response = await fetch(
                    `https://toncenter.com/api/v2/getAddressBalance?address=${address}`
                );
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                // –ë–∞–ª–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞–Ω–æ–∫–æ–∏–Ω–∞—Ö, –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ TON
                return (parseInt(data.result) / 1e9).toFixed(4);
            }

            async sendTransaction(toAddress, amount, payload = '') {
                if (!this.wallet) throw new Error('–ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');

                // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è TON –≤ –Ω–∞–Ω–æ–∫–æ–∏–Ω—ã
                const amountNano = Math.floor(amount * 1e9).toString();

                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 600, // 10 –º–∏–Ω—É—Ç
                    messages: [{
                        address: toAddress,
                        amount: amountNano,
                        payload: payload
                    }]
                };

                try {
                    const result = await this.wallet.sendTransaction(transaction);
                    return result;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', error);
                    throw error;
                }
            }

            async disconnect() {
                if (this.connector) {
                    await this.connector.disconnect();
                    this.wallet = null;
                    this.updateUIForDisconnectedWallet();
                }
            }

            updateUIForConnectedWallet() {
                document.getElementById('statusIndicator').className = 'status-indicator status-connected';
                document.getElementById('statusText').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('connectTonkeeperBtn').classList.add('hidden');
                document.getElementById('disconnectBtn').classList.remove('hidden');
                document.getElementById('walletInfo').classList.add('show');
                this.updateWalletInfoDisplay();
            }

            updateUIForDisconnectedWallet() {
                document.getElementById('statusIndicator').className = 'status-indicator status-disconnected';
                document.getElementById('statusText').textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('connectTonkeeperBtn').classList.remove('hidden');
                document.getElementById('disconnectBtn').classList.add('hidden');
                document.getElementById('walletInfo').classList.remove('show');
            }

            async updateWalletInfoDisplay() {
                const walletInfo = await this.getWalletInfo();
                if (walletInfo) {
                    document.getElementById('connectedAddress').textContent = this.formatAddress(walletInfo.address);
                    document.getElementById('walletBalance').textContent = `${walletInfo.balance} TON`;
                }
            }

            formatAddress(address) {
                if (!address) return '';
                if (address.length > 20) {
                    return `${address.substring(0, 10)}...${address.substring(address.length - 10)}`;
                }
                return address;
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                const notificationMessage = document.getElementById('notificationMessage');
                notificationMessage.textContent = message;

                const colors = {
                    success: '#00cc66',
                    error: '#ff3333',
                    warning: '#ffaa00',
                    info: '#0088cc'
                };
                notification.style.borderLeftColor = colors[type] || colors.info;
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 5000);
            }
        }

        // ============================================================================
        // –ö–ª–∞—Å—Å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ TON
        // ============================================================================
        class TONAddressValidator {
            constructor() {
                this.regexPatterns = {
                    hex: /^[a-fA-F0-9]{64}$/,
                    base64: /^[a-zA-Z0-9+/]{48}$/,
                    friendly: /^(?:[-a-zA-Z0-9]{1,63}\.)+ton$/,
                    telegram: /^@[a-zA-Z0-9_]{5,32}$/,
                    raw: /^[a-fA-F0-9]{48}$/
                };
            }

            validateAddress(address) {
                if (!address || typeof address !== 'string') {
                    return { isValid: false, error: '–ê–¥—Ä–µ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º' };
                }

                const trimmedAddress = address.trim();

                if (this.regexPatterns.hex.test(trimmedAddress)) {
                    return {
                        isValid: true,
                        format: 'hex',
                        normalized: trimmedAddress.toLowerCase(),
                        raw: this.hexToRaw(trimmedAddress)
                    };
                }

                if (this.regexPatterns.base64.test(trimmedAddress)) {
                    return {
                        isValid: true,
                        format: 'base64',
                        normalized: trimmedAddress,
                        raw: this.base64ToRaw(trimmedAddress)
                    };
                }

                if (this.regexPatterns.friendly.test(trimmedAddress)) {
                    return {
                        isValid: true,
                        format: 'friendly',
                        normalized: trimmedAddress.toLowerCase(),
                        raw: null // –¢—Ä–µ–±—É–µ—Ç—Å—è DNS-—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
                    };
                }

                if (this.regexPatterns.telegram.test(trimmedAddress)) {
                    return {
                        isValid: true,
                        format: 'telegram',
                        normalized: trimmedAddress.toLowerCase(),
                        raw: null // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram API
                    };
                }

                if (this.regexPatterns.raw.test(trimmedAddress)) {
                    return {
                        isValid: true,
                        format: 'raw',
                        normalized: trimmedAddress.toLowerCase(),
                        raw: trimmedAddress
                    };
                }

                return {
                    isValid: false,
                    error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hex, base64, .ton, @username –∏–ª–∏ raw —Ñ–æ—Ä–º–∞—Ç'
                };
            }

            hexToRaw(hexAddress) {
                try {
                    const cleanHex = hexAddress.replace(/^0x/, '');
                    if (cleanHex.length !== 64) throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ hex –∞–¥—Ä–µ—Å–∞');
                    const flags = parseInt(cleanHex.substring(0, 2), 16);
                    const hash = cleanHex.substring(2);
                    return hash;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è hex –≤ raw:', error);
                    return null;
                }
            }

            base64ToRaw(base64Address) {
                try {
                    const binaryString = atob(base64Address);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    let hex = '';
                    for (const byte of bytes) {
                        hex += byte.toString(16).padStart(2, '0');
                    }
                    return hex;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è base64 –≤ raw:', error);
                    return null;
                }
            }

            formatForDisplay(address, format = 'hex') {
                if (!address) return '';
                switch (format) {
                    case 'hex':
                    case 'raw':
                        if (address.length > 20) {
                            return `${address.substring(0, 10)}...${address.substring(address.length - 10)}`;
                        }
                        return address;
                    case 'friendly':
                    case 'telegram':
                        return address;
                    default:
                        return address;
                }
            }
        }

        // ============================================================================
        // –ö–ª–∞—Å—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–æ–≤
        // ============================================================================
        class QRCodeGenerator {
            constructor() {
                this.canvas = document.getElementById('qrCode');
                this.qrCode = null;
            }

            async generate(data, options = {}) {
                return new Promise((resolve, reject) => {
                    try {
                        const ctx = this.canvas.getContext('2d');
                        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                        const defaultOptions = {
                            width: 256,
                            height: 256,
                            colorDark: "#0088cc",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        };

                        const mergedOptions = { ...defaultOptions, ...options };

                        this.qrCode = new QRCode(this.canvas, {
                            text: data,
                            width: mergedOptions.width,
                            height: mergedOptions.height,
                            colorDark: mergedOptions.colorDark,
                            colorLight: mergedOptions.colorLight,
                            correctLevel: mergedOptions.correctLevel
                        });

                        resolve(this.canvas.toDataURL('image/png'));
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            download(filename = 'ton-connect-qr.png') {
                if (!this.canvas) throw new Error('QR-–∫–æ–¥ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
                const link = document.createElement('a');
                link.download = filename;
                link.href = this.canvas.toDataURL('image/png');
                link.click();
            }

            clear() {
                const ctx = this.canvas.getContext('2d');
                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }
        }

        // ============================================================================
        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API TON
        // ============================================================================
        class TONAPIHandler {
            constructor() {
                this.baseUrl = 'https://tfragment.stel.com';
                this.endpoints = {
                    authRequest: '/tonkeeper/authRequest',
                    rawRequest: '/tonkeeper/rawRequest'
                };
            }

            async getAuthRequest(websiteUrl, walletAddress = null) {
                const payload = {
                    websiteUrl,
                    timestamp: Date.now(),
                    ...(walletAddress && { walletAddress })
                };

                const response = await fetch(`${this.baseUrl}${this.endpoints.authRequest}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            }

            async getRawRequest(requestId) {
                const response = await fetch(`${this.baseUrl}${this.endpoints.rawRequest}/${requestId}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            }
        }

        // ============================================================================
        // –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        // ============================================================================
        class TONConnectApp {
            constructor() {
                this.connectionManager = new TONConnectionManager();
                this.addressValidator = new TONAddressValidator();
                this.qrGenerator = new QRCodeGenerator();
                this.apiHandler = new TONAPIHandler();
                this.currentConnectionData = null;
                this.initEventListeners();
            }

            initEventListeners() {
                document.getElementById('generateQrBtn').addEventListener('click', () => this.handleGenerateQR());
                document.getElementById('validateAddressBtn').addEventListener('click', () => this.handleValidateAddress());
                document.getElementById('connectTonkeeperBtn').addEventListener('click', () => this.handleConnectTonkeeper());
                document.getElementById('disconnectBtn').addEventListener('click', () => this.handleDisconnect());
                document.getElementById('downloadQrBtn').addEventListener('click', () => this.handleDownloadQR());
                document.getElementById('refreshQrBtn').addEventListener('click', () => this.handleRefreshQR());
                document.getElementById('copyAddressBtn').addEventListener('click', () => this.handleCopyAddress());
                document.getElementById('sendTransactionBtn').addEventListener('click', () => this.showTransactionModal());
                document.getElementById('walletAddress').addEventListener('input', (e) => this.handleAddressInput(e.target.value));
                document.getElementById('websiteUrl').addEventListener('input', () => this.updateConnectionInfo());

                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                document.getElementById('txSubmitBtn').addEventListener('click', () => this.handleSendTransaction());
                document.getElementById('txCancelBtn').addEventListener('click', () => this.hideTransactionModal());
            }

            async handleGenerateQR() {
                try {
                    const websiteUrl = document.getElementById('websiteUrl').value;
                    const walletAddress = document.getElementById('walletAddress').value;

                    if (!websiteUrl) {
                        this.connectionManager.showNotification('–í–≤–µ–¥–∏—Ç–µ URL —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'warning');
                        return;
                    }

                    try {
                        new URL(websiteUrl);
                    } catch {
                        this.connectionManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL', 'error');
                        return;
                    }

                    let validatedAddress = null;
                    if (walletAddress) {
                        const validationResult = this.addressValidator.validateAddress(walletAddress);
                        if (!validationResult.isValid) {
                            this.connectionManager.showNotification(validationResult.error, 'error');
                            return;
                        }
                        validatedAddress = validationResult.normalized;
                    }

                    const connectionData = await this.connectionManager.generateConnectionRequest(websiteUrl);
                    this.currentConnectionData = connectionData;

                    await this.qrGenerator.generate(connectionData.universalLink, {
                        colorDark: "#0088cc",
                        colorLight: "#ffffff"
                    });

                    const deepLinkElement = document.getElementById('deepLink');
                    deepLinkElement.href = connectionData.tonkeeperDeepLink;
                    deepLinkElement.textContent = connectionData.tonkeeperDeepLink;
                    document.getElementById('deepLinkContainer').classList.remove('hidden');

                    this.updateConnectionInfo(connectionData);
                    this.connectionManager.showNotification('QR-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!', 'success');

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞:', error);
                    this.connectionManager.showNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            }

            handleValidateAddress() {
                const addressInput = document.getElementById('walletAddress').value;
                if (!addressInput) {
                    this.connectionManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏', 'warning');
                    return;
                }

                const validationResult = this.addressValidator.validateAddress(addressInput);
                if (validationResult.isValid) {
                    const formattedAddress = this.addressValidator.formatForDisplay(
                        validationResult.normalized,
                        validationResult.format
                    );
                    this.connectionManager.showNotification(
                        `–ê–¥—Ä–µ—Å –≤–∞–ª–∏–¥–µ–Ω! –§–æ—Ä–º–∞—Ç: ${validationResult.format}. –ê–¥—Ä–µ—Å: ${formattedAddress}`,
                        'success'
                    );
                    document.getElementById('walletAddress').value = validationResult.normalized;
                } else {
                    this.connectionManager.showNotification(validationResult.error, 'error');
                }
            }

            async handleConnectTonkeeper() {
                try {
                    const websiteUrl = document.getElementById('websiteUrl').value;
                    if (!websiteUrl) {
                        this.connectionManager.showNotification('–í–≤–µ–¥–∏—Ç–µ URL —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'warning');
                        return;
                    }

                    const connectionData = await this.connectionManager.generateConnectionRequest(websiteUrl);
                    this.currentConnectionData = connectionData;

                    if (this.isMobileDevice()) {
                        window.location.href = connectionData.tonkeeperDeepLink;
                    } else {
                        await this.handleGenerateQR();
                        this.connectionManager.showNotification(
                            '–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ —Å –ø–æ–º–æ—â—å—é Tonkeeper –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ',
                            'info'
                        );
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ Tonkeeper:', error);
                    this.connectionManager.showNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            }

            async handleDisconnect() {
                try {
                    await this.connectionManager.disconnect();
                    this.qrGenerator.clear();
                    document.getElementById('connectionInfo').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞...';
                    document.getElementById('deepLinkContainer').classList.add('hidden');
                    document.getElementById('rawRequestContainer').classList.add('hidden');
                    this.connectionManager.showNotification('–ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω', 'warning');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:', error);
                    this.connectionManager.showNotification(`–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                }
            }

            handleDownloadQR() {
                try {
                    this.qrGenerator.download();
                    this.connectionManager.showNotification('QR-–∫–æ–¥ —Å–∫–∞—á–∞–Ω', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞:', error);
                    this.connectionManager.showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥', 'error');
                }
            }

            async handleRefreshQR() {
                try {
                    const websiteUrl = document.getElementById('websiteUrl').value;
                    if (!websiteUrl) {
                        this.connectionManager.showNotification('–í–≤–µ–¥–∏—Ç–µ URL —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'warning');
                        return;
                    }

                    const connectionData = await this.connectionManager.generateConnectionRequest(websiteUrl);
                    this.currentConnectionData = connectionData;
                    await this.qrGenerator.generate(connectionData.universalLink);

                    const deepLinkElement = document.getElementById('deepLink');
                    deepLinkElement.href = connectionData.tonkeeperDeepLink;
                    deepLinkElement.textContent = connectionData.tonkeeperDeepLink;

                    this.updateConnectionInfo(connectionData);
                    this.connectionManager.showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è QR-–∫–æ–¥–∞:', error);
                    this.connectionManager.showNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            }

            handleCopyAddress() {
                const addressElement = document.getElementById('connectedAddress');
                const address = addressElement.textContent;
                navigator.clipboard.writeText(address).then(() => {
                    this.connectionManager.showNotification('–ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                    this.connectionManager.showNotification('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞', 'error');
                });
            }

            showTransactionModal() {
                document.getElementById('transactionModal').classList.add('active');
            }

            hideTransactionModal() {
                document.getElementById('transactionModal').classList.remove('active');
                document.getElementById('txToAddress').value = '';
                document.getElementById('txAmount').value = '';
                document.getElementById('txPayload').value = '';
            }

            async handleSendTransaction() {
                try {
                    const toAddress = document.getElementById('txToAddress').value.trim();
                    const amount = parseFloat(document.getElementById('txAmount').value);
                    const payload = document.getElementById('txPayload').value.trim();

                    if (!toAddress || !amount || amount <= 0) {
                        this.connectionManager.showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'warning');
                        return;
                    }

                    const validationResult = this.addressValidator.validateAddress(toAddress);
                    if (!validationResult.isValid) {
                        this.connectionManager.showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è', 'error');
                        return;
                    }

                    const result = await this.connectionManager.sendTransaction(
                        validationResult.normalized,
                        amount,
                        payload
                    );

                    this.connectionManager.showNotification(
                        `–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –•–µ—à: ${result.boc.substring(0, 20)}...`,
                        'success'
                    );
                    this.hideTransactionModal();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', error);
                    this.connectionManager.showNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            }

            handleAddressInput(address) {
                if (address.length > 10) {
                    const validationResult = this.addressValidator.validateAddress(address);
                    document.getElementById('walletAddress').style.borderColor = validationResult.isValid ? '#00cc66' : '#ff3333';
                } else {
                    document.getElementById('walletAddress').style.borderColor = 'rgba(46, 125, 209, 0.4)';
                }
            }

            updateConnectionInfo(connectionData = null) {
                const connectionInfoElement = document.getElementById('connectionInfo');
                const websiteUrl = document.getElementById('websiteUrl').value;
                const walletAddress = document.getElementById('walletAddress').value;

                let info = '';
                if (connectionData) {
                    info = `
–°–∞–π—Ç: ${websiteUrl}
–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–ú–µ—Ç–æ–¥: TON Connect
–í–µ—Ä—Å–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞: 2.0
–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${new Date().toLocaleTimeString()}
                    `.trim();

                    document.getElementById('rawRequestContainer').classList.remove('hidden');
                    document.getElementById('rawRequest').textContent = JSON.stringify(connectionData.request, null, 2);
                } else if (walletAddress) {
                    const validationResult = this.addressValidator.validateAddress(walletAddress);
                    if (validationResult.isValid) {
                        info = `
–°–∞–π—Ç: ${websiteUrl}
–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞: ${validationResult.normalized}
–§–æ—Ä–º–∞—Ç: ${validationResult.format}
–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é
                        `.trim();
                    } else {
                        info = `
–°–∞–π—Ç: ${websiteUrl}
–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
                        `.trim();
                    }
                } else {
                    info = `
–°–∞–π—Ç: ${websiteUrl}
–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
                    `.trim();
                }
                connectionInfoElement.textContent = info;
            }

            isMobileDevice() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            window.tonConnectApp = new TONConnectApp();
            window.tonConnectApp.updateConnectionInfo();
        });
    </script>
</body>
</html>
